# file opened: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm
  1   0000                      DEVICE ZXSPECTRUM48
  2   0000                      org $8000
  3   8000                ; Programa ubicado a partir de $8000 = 32768
  4   8000
  5   8000 F3           qinicio:         di              ; Deshabilitar interrupciones
  6   8001 31 00 00                     ld sp,0         ; Establecer el puntero de pila en la parte alta de la memoria
  7   8004
  8   8004              ;-------------------------------------------------------------------------------------------------
  9   8004              ;Código del estudiante
 10   8004
 11   8004 CD 22 80         CALL pantalla
 12   8007 CD 6C 80         CALL EsperarSoltar
 13   800A
 14   800A CD B8 80         CALL slot_XY
 15   800D CD CF 80         CALL Intento
 16   8010
 17   8010
 18   8010              ;-------------------------------------------------------------------------------------------------
 19   8010 18 FE        fin:            jr fin          ; Bucle infinito
 20   8012 00 00 00     intento_actual DB 0,0,0;se guarda en el primer 0 el intento(ld(intento),a->numero de intentos,se saca ld a ,(intento),el segundo 0 es la posicion del primer slot,el tercer 0 es la posición del espacio de validación)
 21   8015              ;validación,slot,intento
 22   8015 00           espacioV DB 0;//Espacios de validacion
 23   8016 00 00 00 00  intento DB 0,0,0,0;//variable de intentos del usuario
 24   801A 09 00 00 00  clave DB 9,0,0,0;
 25   801E 00 00 00 00  claveTemp DB 0,0,0,0;
 26   8022                      include "pantalla.asm"
# file opened: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\pantalla.asm
  1+  8022              pantalla:
  2+  8022 3E 00               ld a,$00
  3+  8024 D3 FE               out($fe),a ;Ponemos el marco negro
  4+  8026 21 28 58            ld hl,$5828 ;posicion 5828 para poner el tablero en el medio
  5+  8029 06 0A               ld b,10 ;bucle exterior
  6+  802B 11 28 58             ld de,$5828 ;Uso de variable de como auxiliar para guardar cada linea
  7+  802E              bucleext;
  8+  802E 62 6B               ld hl,de ;metemos el valor en hl,que será el principio de cada linea
  9+  8030 0E 0F                ld c,15;control de bucle 1
 10+  8032 3E 09                ld a,$09 ;color a
 11+  8034
 12+  8034              bucle1: ;bucle para hacer lineas horizontales menos la ultima de todas
 13+  8034
 14+  8034 77                  ld(hl),a  ;cargo el color en su sitio
 15+  8035 23                  inc hl; ;incremento para que haga la linea
 16+  8036 0D                   dec c;decremento c para que no sea bucle infinito(variable del bucle)
 17+  8037 20 FB               jr nz, bucle1; usamos jr para que tenga como referencia el decremento de c
 18+  8039 0E 11               ld c,17;
 19+  803B              buclepr:
 20+  803B 23                   inc hl;
 21+  803C 0D                   dec c;
 22+  803D 20 FC                jr nz,buclepr
 23+  803F 0E 04                ld c,4 ;declaramos c para el siguiente bucle
 24+  8041              bucleaux: ;este bucle realizará los slots.
 25+  8041 3E 09                ld a,$09 ;cargo el color azul en a
 26+  8043 77                   ld (hl),a ;lo metemos en la posición de hl para que lo pinte
 27+  8044 23                   inc hl ;incremento hl para meter el siguiente color
 28+  8045 3E 01                ld a,$01 ;cargo negro en a
 29+  8047 77                   ld(hl),a ;cargo en la posición de hl para que  lo pinte
 30+  8048 23                   inc hl ; incremento hl para meter el siguiente color
 31+  8049 0D                   dec c ; decremento c para que haga 4 veces el bucle
 32+  804A 20 F5                jr nz,bucleaux ;utilizo jr nz para que coja c como variable
 33+  804C
 34+  804C 3E 09                ld a,$09 ;Cargo el color azul otra vez para realizar la evaluación de aciertos
 35+  804E 77                   ld (hl),a ;Cargo en hl,que será el borde del rectangulo
 36+  804F 23                   inc hl
 37+  8050 3E 01                ld a,$01 ;Cargo el color negro y a continuación realizo un bucle donde me pinte los 5 de color negro
 38+  8052 0E 05                ld c,5
 39+  8054              bucleaux2:
 40+  8054 77                   ld (hl),a
 41+  8055 23                   inc hl
 42+  8056 0D                   dec c
 43+  8057 20 FB                jr nz,bucleaux2
 44+  8059 3E 09                ld a,$09 ;Vuelvo a cargar en azul para realizar el borde
 45+  805B 77                   ld (hl),a
 46+  805C 0E 12                ld c,18;
 47+  805E              buclepr2:
 48+  805E 23                   inc hl;
 49+  805F 0D                   dec c;
 50+  8060 20 FC                jr nz,buclepr2
 51+  8062 10 CA                djnz bucleext; Finaliza el bucle principal,donde pintará todo menos la ultima linea inferior
 52+  8064 0E 0F                ld c,15 ;Cargo 15 en c para que me haga la linea 15 pixeles
 53+  8066              bucleinf: ;hago el bucle para que pinte las 15 lineas
 54+  8066 77                   ld(hl),a
 55+  8067 23                   inc hl
 56+  8068 0D                   dec c
 57+  8069 20 FB                jr nz,bucleinf ;finaliza el bucle de la linea inferior
 58+  806B C9                   RET
# file closed: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\pantalla.asm
 27   806C
 28   806C              EsperarSoltar:;se comprueba si la tecla q es pulsada
 29   806C 16 00                ld d,$00
 30   806E 3E FB                ld a,$fb
 31   8070 DB FE                in a,($fe)
 32   8072 CB 47                bit $00,a;con el bit se cambia de tecla,tecla q
 33   8074 28 F6                jr z,EsperarSoltar;si pulsa Salta
 34   8076 14                   inc d
 35   8077 3E FB                ld a,$fb
 36   8079 DB FE                in a,($fe)
 37   807B CB 4F                bit $01,a;tecla w
 38   807D 28 ED                jr z,EsperarSoltar;si no pulsa Salta
 39   807F 14                   inc d
 40   8080 3E FB                ld a,$fb
 41   8082 DB FE                in a,($fe)
 42   8084 CB 57                bit $02,a;tecla e
 43   8086 28 E4                jr z,EsperarSoltar
 44   8088 14                   inc d
 45   8089 3E FB                ld a,$fb
 46   808B DB FE                in a,($fe)
 47   808D CB 5F                bit $03,a;tecla r
 48   808F 28 DB                jr z,EsperarSoltar
 49   8091 14                   inc d
 50   8092 3E FB                ld a,$fb
 51   8094 DB FE                in a,($fe)
 52   8096 CB 5F                bit $03,a;tecla r
 53   8098 28 D2                jr z,EsperarSoltar
 54   809A 14                   inc d
 55   809B 3E FB                ld a,$fb
 56   809D DB FE                in a,($fe)
 57   809F CB 67                bit $04,a;tecla t
 58   80A1 28 C9                jr z,EsperarSoltar
 59   80A3 14                   inc d
 60   80A4 7A                   ld a,d
 61   80A5 E6 06                and $06;2 en a significa que no están pulsadas.
 62   80A7 20 01                jr nz,prueba1;entra cuando es 1 el and(cuando las teclas no están pulsadas)
 63   80A9 C9                   RET
 64   80AA              prueba1:
 65   80AA 3E 19                ld a,$19
 66   80AC 21 30 58             ld hl,$5830
 67   80AF 77                   ld(hl),a
 68   80B0 C9                   RET
 69   80B1              Prueba:;entra aqui si esta pulsando una tecla
 70   80B1 3E 12                ld a,$12
 71   80B3 21 30 58             ld hl,$5830
 72   80B6 77                   ld(hl),a
 73   80B7 C9                   RET
 74   80B8
 75   80B8              slot_XY:
 76   80B8 3E 01                ld a,1
 77   80BA 32 12 80             ld (intento_actual),a;
 78   80BD 21 49 58             ld hl,$5849
 79   80C0 22 13 80             ld (intento_actual+1),hl;slot primero,cada 40
 80   80C3 C9                   RET
 81   80C4
 82   80C4              validacionXY:
 83   80C4 21 51 58             ld hl,$5851
 84   80C7 22 14 80         ld (intento_actual+2),hl;slot de validación
 85   80CA 23                   inc hl
 86   80CB 22 15 80          ld (espacioV),hl;
 87   80CE C9                   RET
 88   80CF              Intento:
 89   80CF 0E 04                ld c,4
 90   80D1              buclecopia:
 91   80D1 2A 1A 80             ld hl,(clave)
 92   80D4 7E                   ld a,(hl)
c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm(93): warning: value 0x801E is truncated to 8bit value: 0x1E
 93   80D5 06 1E                ld b,(claveTemp)
 94   80D7 47                   ld b,a
 95   80D8 23                   inc hl
 96   80D9 04                   inc b
 97   80DA 0D                   dec c
 98   80DB 20 F4                jr nz,buclecopia;
 99   80DD
100   80DD 0E 00                ld c,0;contador
101   80DF 3A 1A 80             ld a,(clave)
c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm(102): warning: value 0x801E is truncated to 8bit value: 0x1E
102   80E2 06 1E                ld b,(claveTemp)
103   80E4
104   80E4 B8                   cp b
105   80E5
106   80E5 C9                   RET
107   80E6
# file closed: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm
