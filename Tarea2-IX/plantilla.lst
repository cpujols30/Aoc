# file opened: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm
 1    0000                      DEVICE ZXSPECTRUM48
 2    0000                      org $8000
 3    8000                ; Programa ubicado a partir de $8000 = 32768
 4    8000
 5    8000 F3           inicio:         di              ; Deshabilitar interrupciones
 6    8001 31 00 00                     ld sp,0         ; Establecer el puntero de pila en la parte alta de la memoria
 7    8004
 8    8004              ;-------------------------------------------------------------------------------------------------
 9    8004              ;Código del estudiante
10    8004
11    8004 CD 26 80         CALL pantalla
12    8007 CD 70 80         CALL JugarSlot
13    800A 7B               ld a,e
14    800B 32 16 80         ld (intento_actual),a
15    800E CD C4 80         CALL slot_XY
16    8011 CD DB 80         CALL Intento
17    8014
18    8014
19    8014              ;-------------------------------------------------------------------------------------------------
20    8014 18 FE        fin:            jr fin          ; Bucle infinito
21    8016 00 00 00     intento_actual DB 0,0,0;se guarda en el primer 0 el intento(ld(intento),a->numero de intentos,se saca ld a ,(intento),el segundo 0 es la posicion del primer slot,el tercer 0 es la posición del espacio de validación)
22    8019              ;validación,slot,intento
23    8019 00           espacioV DB 0;//Espacios de validacion
24    801A 00 00 00 00  intento DB 0,0,0,0;//variable de intentos del usuario
25    801E 09 00 00 00  clave DB 9,0,0,0;
26    8022 00 00 00 00  claveTemp DB 0,0,0,0;
27    8026
28    8026                      include "pantalla.asm"
# file opened: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\pantalla.asm
 1+   8026              pantalla:
 2+   8026 3E 00               ld a,$00
 3+   8028 D3 FE               out($fe),a ;Ponemos el marco negro
 4+   802A 21 28 58            ld hl,$5828 ;posicion 5828 para poner el tablero en el medio
 5+   802D 06 0A               ld b,10;bucle exterior
 6+   802F 11 28 58             ld de,$5828 ;Uso de variable de como auxiliar para guardar cada linea
 7+   8032 62 6B                ld hl,de
 8+   8034              bucleext;
 9+   8034 0E 0F                ld c,15;control de bucle 1
10+   8036 3E 09                ld a,$09 ;color a
11+   8038
12+   8038              bucle1: ;bucle para hacer lineas horizontales menos la ultima de todas
13+   8038
14+   8038 77                  ld(hl),a  ;cargo el color en su sitio
15+   8039 23                  inc hl; ;incremento para que haga la linea
16+   803A 0D                   dec c;decremento c para que no sea bucle infinito(variable del bucle)
17+   803B 20 FB               jr nz, bucle1; usamos jr para que tenga como referencia el decremento de c
18+   803D 0E 11               ld c,17;
19+   803F              buclepr:
20+   803F 23                   inc hl;
21+   8040 0D                   dec c;
22+   8041 20 FC                jr nz,buclepr
23+   8043 0E 04                ld c,4 ;declaramos c para el siguiente bucle
24+   8045              bucleaux: ;este bucle realizará los slots.
25+   8045 3E 09                ld a,$09 ;cargo el color azul en a
26+   8047 77                   ld (hl),a ;lo metemos en la posición de hl para que lo pinte
27+   8048 23                   inc hl ;incremento hl para meter el siguiente color
28+   8049 3E 01                ld a,$01 ;cargo negro en a
29+   804B 77                   ld(hl),a ;cargo en la posición de hl para que  lo pinte
30+   804C 23                   inc hl ; incremento hl para meter el siguiente color
31+   804D 0D                   dec c ; decremento c para que haga 4 veces el bucle
32+   804E 20 F5                jr nz,bucleaux ;utilizo jr nz para que coja c como variable
33+   8050
34+   8050 3E 09                ld a,$09 ;Cargo el color azul otra vez para realizar la evaluación de aciertos
35+   8052 77                   ld (hl),a ;Cargo en hl,que será el borde del rectangulo
36+   8053 23                   inc hl
37+   8054 3E 01                ld a,$01 ;Cargo el color negro y a continuación realizo un bucle donde me pinte los 5 de color negro
38+   8056 0E 05                ld c,5
39+   8058              bucleaux2:
40+   8058 77                   ld (hl),a
41+   8059 23                   inc hl
42+   805A 0D                   dec c
43+   805B 20 FB                jr nz,bucleaux2
44+   805D 3E 09                ld a,$09 ;Vuelvo a cargar en azul para realizar el borde
45+   805F 77                   ld (hl),a
46+   8060 0E 12                ld c,18;
47+   8062              buclepr2:
48+   8062 23                   inc hl;
49+   8063 0D                   dec c;
50+   8064 20 FC                jr nz,buclepr2
51+   8066 10 CC                djnz bucleext; Finaliza el bucle principal,donde pintará todo menos la ultima linea inferior
52+   8068 0E 0F                ld c,15 ;Cargo 15 en c para que me haga la linea 15 pixeles
53+   806A              bucleinf: ;hago el bucle para que pinte las 15 lineas
54+   806A 77                   ld(hl),a
55+   806B 23                   inc hl
56+   806C 0D                   dec c
57+   806D 20 FB                jr nz,bucleinf ;finaliza el bucle de la linea inferior
58+   806F C9                   RET
# file closed: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\pantalla.asm
29    8070                      include "Teclado.asm"
# file opened: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\Teclado.asm
 1+   8070              JugarSlot:
 2+   8070 06 00                ld b,$00
 3+   8072 1E 00                ld e,$00
 4+   8074              bucleteclas:
 5+   8074 21 49 58         ld hl,$5849
 6+   8077
 7+   8077 CD 82 80         CALL EsperarSoltar
 8+   807A CD 8B 80         CALL EsperarPulsar
 9+   807D
10+   807D
11+   807D FE 01            cp $01
12+   807F 20 F3            jr nz,bucleteclas;salta cuando está a 0
13+   8081 C9                   RET
14+   8082              EsperarSoltar:;se comprueba si la tecla q es pulsada
15+   8082 3E FB                ld a,$fb
16+   8084 DB FE                in a,($fe)
17+   8086 FE FF                cp $FF
18+   8088 20 F8                jr nz,EsperarSoltar
19+   808A C9                   RET
20+   808B
21+   808B              EsperarPulsar:
22+   808B 3E FB                ld a,$fb
23+   808D DB FE                in a,($fe)
24+   808F CB 47                bit 0,a;con el bit se cambia de tecla,tecla q
25+   8091 28 12                jr z,TeclaQPulsada
26+   8093 3E FB                ld a,$fb
27+   8095 DB FE                in a,($fe)
28+   8097 CB 4F                bit 1,a;con el bit se cambia de tecla,tecla w
29+   8099 28 14                jr z,TeclaWPulsada
30+   809B 3E FB                ld a,$fb
31+   809D DB FE                in a,($fe)
32+   809F CB 67                bit 4,a;con el bit se cambia de tecla,tecla t
33+   80A1 28 16                jr z,TeclaTPulsada
34+   80A3 18 E6                jr EsperarPulsar;si pulsa Salta
35+   80A5
36+   80A5              TeclaQPulsada:;entra aqui si esta pulsando una tecla
37+   80A5 7B                   ld a,e
38+   80A6 C6 08               add $08
39+   80A8 77                   ld(hl),a
40+   80A9 5F                   ld e,a
41+   80AA FE 40               cp $40
42+   80AC 28 0E               jr z,ReinicioColor1
43+   80AE C9                   RET
44+   80AF
45+   80AF              TeclaWPulsada:
46+   80AF 7B                   ld a,e
47+   80B0 D6 08                sub $08
48+   80B2 77                   ld(hl),a
49+   80B3 5F                   ld e,a
50+   80B4 FE 00                cp $00
51+   80B6 28 08                jr z,ReinicioColor2
52+   80B8 C9                   RET
53+   80B9              TeclaTPulsada:
54+   80B9 3E 01                ld a,1
55+   80BB C9                   RET
56+   80BC
57+   80BC              ReinicioColor1:
58+   80BC 1E 00                ld e,$00
59+   80BE 28 CB                jr z,EsperarPulsar
60+   80C0              ReinicioColor2:
61+   80C0 1E 32                ld e,$32
62+   80C2 28 C7                jr z,EsperarPulsar
# file closed: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\Teclado.asm
30    80C4
31    80C4              slot_XY:
32    80C4 3E 01                ld a,1
33    80C6 32 16 80             ld (intento_actual),a;
34    80C9 21 49 58             ld hl,$5849
35    80CC 22 17 80             ld (intento_actual+1),hl;slot primero,cada 40
36    80CF C9                   RET
37    80D0
38    80D0              validacionXY:
39    80D0 21 51 58             ld hl,$5851
40    80D3 22 18 80         ld (intento_actual+2),hl;slot de validación
41    80D6 23                   inc hl
42    80D7 22 19 80          ld (espacioV),hl;
43    80DA C9                   RET
44    80DB              Intento:
45    80DB 0E 04                ld c,4
46    80DD              buclecopia:
47    80DD 2A 1E 80             ld hl,(clave)
48    80E0 7E                   ld a,(hl)
c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm(49): warning: value 0x8022 is truncated to 8bit value: 0x22
49    80E1 06 22                ld b,(claveTemp)
50    80E3 47                   ld b,a
51    80E4 23                   inc hl
52    80E5 04                   inc b
53    80E6 0D                   dec c
54    80E7 20 F4                jr nz,buclecopia;
55    80E9
56    80E9 0E 00                ld c,0;contador
57    80EB 3A 1E 80             ld a,(clave)
c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm(58): warning: value 0x8022 is truncated to 8bit value: 0x22
58    80EE 06 22                ld b,(claveTemp)
59    80F0 B8                   cp b
60    80F1 C9                   RET
61    80F2
# file closed: c:\Users\cpujo\Desktop\Aoc\Tarea2-IX\plantilla.asm
